# This is an example environment file.
# Copy this file to .env and fill in your actual configuration values.
# The .env file is git-ignored and should NOT be committed to source control.

# -----------------------------------------------------------------------------
# SECTION 1: CORE APPLICATION CONFIGURATION (REQUIRED)
# These variables are essential for the server to start and function correctly.
# -----------------------------------------------------------------------------

# The full connection string for your MongoDB instance.
DATABASE_URL="mongodb://user:password@localhost:27017/flutter_news_app_api_server_full_source_code_db"

# A secure, randomly generated secret for signing JSON Web Tokens (JWTs).
JWT_SECRET_KEY="your-super-secret-and-long-jwt-key"

# REQUIRED FOR PRODUCTION: The specific origin URL of your web client (e.g., the dashboard).
# This is critical for allowing the web app to make requests to the API.
# For local development, this can be left unset as 'localhost' is allowed by default.
CORS_ALLOWED_ORIGIN="https://your-dashboard.com"

# Sets the single administrator account for the application.
# On server startup, the system ensures that the user with this email is the
# one and only administrator.
OVERRIDE_ADMIN_EMAIL="admin@example.com"


# -----------------------------------------------------------------------------
# SECTION 2: EXTERNAL PROVIDER CREDENTIALS
# Define your API keys and secrets here. These are referenced by various features.
# -----------------------------------------------------------------------------

# --- Firebase / Google Cloud ---
# Used for: Push Notifications (FCM), Google Analytics, Google Play Validation
FIREBASE_PROJECT_ID="your-firebase-project-id"
FIREBASE_CLIENT_EMAIL="your-firebase-client-email"
FIREBASE_PRIVATE_KEY="your-firebase-private-key"

# --- OneSignal ---
# Used for: Push Notifications, Email Delivery
# Note: For Android Push, ensure FCM Server Key is set in OneSignal dashboard.
ONESIGNAL_APP_ID="your-onesignal-app-id"
ONESIGNAL_REST_API_KEY="your-onesignal-rest-api-key"

# --- SendGrid ---
# Used for: Email Delivery
SENDGRID_API_KEY="your-sendgrid-api-key"
# The base URL for the SendGrid API. Defaults to "https://api.sendgrid.com".
# SENDGRID_API_URL="https://api.sendgrid.com"

# --- Mixpanel ---
# Used for: Analytics
MIXPANEL_PROJECT_ID="your-mixpanel-project-id"
MIXPANEL_SERVICE_ACCOUNT_USERNAME="your-mixpanel-service-account-username"
MIXPANEL_SERVICE_ACCOUNT_SECRET="your-mixpanel-service-account-secret"

# -----------------------------------------------------------------------------
# SECTION 3: FEATURE CONFIGURATION
# -----------------------------------------------------------------------------
# ‚ö†Ô∏è PROVIDERS SELECTION GUIDE:
#
# [STATIC] - Configured explicitly in this file.
#  - Email Service 
#
# [DYNAMIC] - Controlled remotely via the Admin Dashboard.
#  - Push Notifications, Analytics, Ads 
#
# Note: For Dynamic Features, you must still provide the API credentials for all providers in
# Section 2, but the active provider is switched at runtime via the Dashboard.
# -----------------------------------------------------------------------------

# --- Email Service (Static) ---
# Select the active provider: "sendgrid", "onesignal", or "logging" (dev only).
EMAIL_PROVIDER="sendgrid"
DEFAULT_SENDER_EMAIL="noreply@example.com"
# The Template ID for the One-Time Password (OTP) email.
# Required for both SendGrid (Dynamic Template ID) and OneSignal (Template ID).
OTP_TEMPLATE_ID="d-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"

# --- Analytics ---
# The ID of your Google Analytics 4 property.
# Note: This requires the Firebase credentials from Section 3 to be configured
# as it uses the same authentication mechanism.
GOOGLE_ANALYTICS_PROPERTY_ID="your-ga4-property-id"

# -----------------------------------------------------------------------------
# SECTION 4: API SECURITY & RATE LIMITING (OPTIONAL)
# Fine-tune security settings. Defaults are provided if these are not set.
# -----------------------------------------------------------------------------

# Limit for the /auth/request-code endpoint (requests per window). Defaults to 3.
# RATE_LIMIT_REQUEST_CODE_LIMIT=3

# Window for the /auth/request-code endpoint, in hours. Defaults to 24.
# RATE_LIMIT_REQUEST_CODE_WINDOW_HOURS=24

# Limit for the generic /data API endpoints (requests per window). Defaults to 1000.
# RATE_LIMIT_DATA_API_LIMIT=1000

# Window for the /data API endpoints, in minutes. Defaults to 60.
# RATE_LIMIT_DATA_API_WINDOW_MINUTES=60


# -----------------------------------------------------------------------------
# SECTION 5: ADVANCED & MISCELLANEOUS CONFIGURATION (OPTIONAL)
# -----------------------------------------------------------------------------

# The duration for which a JWT is valid, in hours. Defaults to 720 (30 days).
# JWT_EXPIRY_HOURS="720"

# The cache duration for the CountryQueryService, in minutes. Defaults to 15.
# COUNTRY_SERVICE_CACHE_MINUTES=15

# -----------------------------------------------------------------------------
# WIKI CONTENT: COPY FROM HERE
# -----------------------------------------------------------------------------


---

# üõ†Ô∏è Guide: Environment Configuration (.env)

The API server uses a `.env` file to manage environment-specific configuration, such as database connection strings, API keys, and feature toggles. This approach keeps sensitive data out of your source code.

### Creating Your `.env` File

First, copy the example file to create your local configuration file. Run this command from the project root:

```bash
cp .env.example .env
```

Open the new `.env` file and fill in the values as described below.

## 1. Core Application Configuration (Required)

These variables are essential for the server to start and function correctly.

| Variable | Description | Example / Default |
| :--- | :--- | :--- |
| `DATABASE_URL` | **Required.** The full connection string for your MongoDB instance. | `mongodb://localhost:27017/my_db` |
| `JWT_SECRET_KEY` | **Required.** A cryptographically secure random string used to sign JSON Web Tokens. **Do not share this.** | `your-super-secret-key-at-least-64-chars` |
| `CORS_ALLOWED_ORIGIN` | **Required for Production.** The URL of your web client (dashboard) allowed to make API requests. | `https://dashboard.yourdomain.com` |
| `OVERRIDE_ADMIN_EMAIL` | **Optional.** Sets the single administrator account on startup. If set, this user is guaranteed to be the admin. | `admin@example.com` |

## 2. External Provider Credentials

Define your API keys and secrets here. These are referenced by various features like Analytics, Push Notifications, and Email.

### Firebase / Google Cloud
*Used for: Push Notifications (FCM), Google Analytics 4, Google Play Validation.*

| Variable | Description |
| :--- | :--- |
| `FIREBASE_PROJECT_ID` | The Project ID from your Firebase console. |
| `FIREBASE_CLIENT_EMAIL` | The `client_email` field from your Firebase Service Account JSON key. |
| `FIREBASE_PRIVATE_KEY` | The `private_key` field from your Firebase Service Account JSON key. |

### OneSignal
*Used for: Push Notifications, Email Delivery.*

| Variable | Description |
| :--- | :--- |
| `ONESIGNAL_APP_ID` | The App ID for your OneSignal application. |
| `ONESIGNAL_REST_API_KEY` | The REST API Key for your OneSignal application. |

### SendGrid
*Used for: Email Delivery.*

| Variable | Description |
| :--- | :--- |
| `SENDGRID_API_KEY` | Your SendGrid API Key. |
| `SENDGRID_API_URL` | (Optional) Base URL for the API. Defaults to `https://api.sendgrid.com`. |

### Mixpanel
*Used for: Analytics.*

| Variable | Description |
| :--- | :--- |
| `MIXPANEL_PROJECT_ID` | Your Mixpanel Project ID. |
| `MIXPANEL_SERVICE_ACCOUNT_USERNAME` | The username for your Mixpanel Service Account. |
| `MIXPANEL_SERVICE_ACCOUNT_SECRET` | The secret for your Mixpanel Service Account. |

## 3. Feature Configuration

### Email Service (Static)
Select which provider to use for sending emails (e.g., OTPs).

| Variable | Description |
| :--- | :--- |
| `EMAIL_PROVIDER` | **Required.** Choose one: `sendgrid`, `onesignal`, or `logging` (for local dev). |
| `DEFAULT_SENDER_EMAIL` | **Required.** The "From" address. Must be verified with your provider. |
| `OTP_TEMPLATE_ID` | **Required.** The ID of the email template used for OTPs. |

### Analytics
Configure the connection to your analytics provider.

| Variable | Description |
| :--- | :--- |
| `GOOGLE_ANALYTICS_PROPERTY_ID` | The Property ID for your Google Analytics 4 property. Requires Firebase credentials to be set. |

## 4. Rate Limiting & Security (Optional)

Fine-tune API security settings. Defaults are provided if these are not set.

| Variable | Default | Description |
| :--- | :--- | :--- |
| `RATE_LIMIT_REQUEST_CODE_LIMIT` | `3` | Max sign-in attempts per window. Keep low to prevent abuse. |
| `RATE_LIMIT_REQUEST_CODE_WINDOW_HOURS` | `24` | Time window for sign-in limits (in hours). |
| `RATE_LIMIT_DATA_API_LIMIT` | `1000` | Max general API requests per window. |
| `RATE_LIMIT_DATA_API_WINDOW_MINUTES` | `60` | Time window for general API limits (in minutes). |
| `JWT_EXPIRY_HOURS` | `720` | Duration (in hours) a user session remains valid (30 days). |
